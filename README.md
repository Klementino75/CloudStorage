## Дипломный проект: "Облачное хранилище".

### Описание проекта.
Разработать приложение - _REST-сервис_. Сервис должен предоставить _REST_ интерфейс для возможности загрузки файлов и вывода списка уже загруженных файлов пользователя.
Все запросы к сервису должны быть авторизованы. Заранее подготовленное веб-приложение (_FRONT_) должно подключаться к разработанному сервису без доработок,
а также использовать функционал FRONT для авторизации, загрузки и вывода списка файлов пользователя.

### Требования к приложению:
- Сервис должен предоставлять _REST_ интерфейс для интеграции с _FRONT_.
- Сервис должны реализовывать все методы описанные [yaml файле](./CloudServiceSpecification.yaml):
   1. Вывод списка файлов.
   2. Добавление файла.
   3. Удаление файла.
   4. Авторизация.
- Все настройки должны вычитываться из файла настроек (_yml_).
- Информация о пользователях сервиса (логины для авторизации) и данных должны храниться в базе данных (на выбор студента).

### Требования в реализации:
- Приложение разработано с использованием _Spring Boot_.
- Использован сборщик пакетов _gradle/maven_.
- Для запуска используется _docker_, _docker-compose_.
- Код размещен на _github_.
- Код покрыт unit тестами с использованием _mockito_.
- Добавлены интеграционные тесты с использованием _testcontainers_.

### Шаги реализации:
- Изучить протокол получения и отправки сообщений между _FRONT_ и _BACKEND_.
- Нарисовать схему приложений.
- Описать архитектуру приложения (где хранятся настройки и хранение больших файлов, структуру таблиц/коллекций базы данных).
- Создать репозиторий проекта на _github_.
- Написать приложение с использованием _Spring Boot_.
- Протестировать приложение с помощью _curl/postman_.
- Протестировать приложение с _FRONT_.
- Написать _README.md_ к проекту.

### Запуск приложения _CloudStorage_

#### Запуск _FRONT:_

1. Установить _nodejs_ (версия не ниже 14.15.0) на компьютер следуя инструкции: https://nodejs.org/ru/download/.
2. Скачать [_FRONT_](./netology-diplom-frontend) (_JavaScript_).
3. Перейти в папку _FRONT_ приложения и все команды для запуска выполнять из нее.
4. Следуя описанию _README.md FRONT_ проекта запустить _nodejs_ приложение (npm install...).
5. Можно задать _url_ для вызова своего _backend_ сервиса:
   - В файле `.env` _FRONT_ (находится в корне проекта) приложения нужно изменить _url_ до _backend_, например: `VUE_APP_BASE_URL=http://localhost:8080`.
   - Пересобрать и запустить _FRONT_ снова: `npm run build`.
   - Измененный `url` сохранится для следующих запусков.
6. По-умолчанию _FRONT_ запускается на порту _8080_ и доступен по _url_ в браузере `http://localhost:8080`.

#### Авторизация приложения:

_FRONT_ приложение использует header `auth-token` в котором отправляет токен (ключ-строка) для идентификации пользователя на _BACKEND_.
Для получения токена нужно пройти авторизацию на _BACKEND_ и отправить на метод _/login_ пару логин и пароль, в случае успешной проверки в ответ _BACKEND_ должен вернуть json объект
с полем `auth-token` и значением токена. Все дальнейшие запросы с _FRONTEND_, кроме метода _/login_ отправляются с этим _header_.
Для выхода из приложения нужно вызвать метод _BACKEND_ _/logout_, который удалит/деактивирует токен и последующие запросы с этим токеном будут не авторизованы и возвращать код 401.

Для запуска _FRONT_ приложения с расширенным логированием нужно использовать команду: `npm run serve`.

#### Запуск _BACKEND:_

- Скопировать и распаковать zip-файл с проектом на свой _ПК_ [CloudStorage.zip](https://github.com/Klementino75/CloudStorage/blob/main/CloudStorage.zip).
- Запускаем приложение [Docker Desktop](https://www.docker.com/products/docker-desktop/).
- Запускаем терминал в папке `/CloudStorage` и собираем _jar-архив_ с нашим _Spring Boot_ приложением:
   1. ```mvn clean package -Dskiptests```
   2. ```mvn clean package -Dmaven.test.skip``` - без тестов
   
  Собирать _jar-файл_ можно с помощью [IntelliJ IDEA](https://www.jetbrains.com/help/idea/work-with-tests-in-maven.html).


- После успешной сборки получаем _jar-файл:_ `/CloudStorage/target/CloudStorage-0.0.1-SNAPSHOT.jar`.
- В терминале выполнить команду по сборке _images_ и _containers:_ ```docker-compose up```.
- В _Docker Desktop_ запустятся 3 приложения:
   1. Backend App Java 17 -> ```http://localhost:8080```
   2. Frontend App Node 15 -> ```http://localhost:8090```
   3. Database Postgres 14 -> ```http://localhost:5432```


- Запуск тестов: `mvn test`.


- Проверить app _CloudStorage API_ c помощью _swagger:_ ```http://localhost:8080/swagger-ui/index.html```.


- Для тестирования _backend + postgres_ авторизовать пользователя:
   1. Отправить POST запрос `http://localhost:8080/login`;
   2. JSON -> `{ "login": "user@test.com", "password": "Qwerty1234" }`;
   3. Полученный в ответ auth-token ввести в окне `Authorize`.


- Если в базе данных postgres нет этого пользователя, то его необходимо создать:
   1. Отправить POST запрос `http://localhost:8080/users/create`;
   2. JSON -> `{ "login": "user@test.com", "password": "Qwerty1234" }`.


- Для тестирования _frontend + backend + postgres_ перейти по ссылке и ввести:
   1. `http://localhost:8090/login`;
   2. логин `user@test.com`;
   3. пароль: `Qwerty1234`.


- Удаление _Docker-контейнера_: ```docker-compose down```.

`http://localhost:8080/users/create`

> `{ "login": "admin@test.com", "password": "Qwerty1111" }`

> `{ "login": "admin@test.com", "password": "$2a$12$pBqGg4hhFmlYJuRCNadI3ehWlX6EnLdpHgQRnkIinsh6rIPm6ZbyC" }`

